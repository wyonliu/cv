<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wyon Liu · CV</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
  <style>
    /* ── Reset ─────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { font-size: 16px; }
    body {
      font-family: 'Noto Sans SC', 'Inter', -apple-system, sans-serif;
      background: #fff;
      color: #1c1c1c;
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ── Page ───────────────────────────────────────── */
    .page {
      max-width: 700px;
      margin: 0 auto;
      padding: 3.5rem 2.5rem 5rem;
    }
    @media (max-width: 600px) {
      .page { padding: 2.5rem 1.5rem 4rem; }
    }

    /* ── Hero ───────────────────────────────────────── */
    #hero {
      padding-bottom: 2.25rem;
      margin-bottom: 0;
      border-bottom: 1.5px solid #1c1c1c;
    }
    #hero h1 {
      font-size: 1.75rem;
      font-weight: 400;
      letter-spacing: -0.025em;
      line-height: 1.15;
      margin-bottom: 0.55rem;
    }
    #hero .tagline {
      font-size: 0.68rem;
      font-weight: 400;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #888;
      margin-bottom: 0.9rem;
    }
    #hero .contact {
      font-size: 0.78rem;
      color: #999;
      line-height: 1.8;
    }
    #hero .contact a { color: #999; text-decoration: none; border-bottom: 1px solid #ddd; }
    #hero .contact a:hover { color: #1c1c1c; border-color: #1c1c1c; }

    /* ── Body content ───────────────────────────────── */
    #content { padding-top: 0; }

    /* Part I / Part II — treat as section dividers */
    #content h1 {
      font-size: 0.62rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #bbb;
      margin: 2.75rem 0 1.5rem;
      padding-top: 2.75rem;
      border-top: 1px solid #ebebeb;
    }
    #content h1:first-child {
      padding-top: 2.75rem;
      border-top: none;
    }

    /* Job / Role entry header */
    #content h2 {
      font-size: 0.9375rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      margin: 2rem 0 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 1rem;
      flex-wrap: wrap;
    }
    #content h2 .role { color: #1c1c1c; flex: 1; }
    #content h2 .date {
      font-size: 0.75rem;
      font-weight: 400;
      color: #aaa;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* Sub-project header */
    #content h3 {
      font-size: 0.8375rem;
      font-weight: 600;
      margin: 1.5rem 0 0.35rem;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    #content h3 .proj-title { color: #333; flex: 1; }
    #content h3 .proj-date {
      font-size: 0.7rem;
      font-weight: 400;
      color: #bbb;
      white-space: nowrap;
      flex-shrink: 0;
    }

    /* h4 — rare, smaller than h3 */
    #content h4 {
      font-size: 0.8rem;
      font-weight: 500;
      color: #555;
      margin: 1.1rem 0 0.3rem;
    }

    /* Paragraph */
    #content p {
      font-size: 0.85rem;
      color: #555;
      margin-bottom: 0.5rem;
      line-height: 1.75;
    }

    /* Bold */
    #content strong { color: #1c1c1c; font-weight: 600; }

    /* Lists */
    #content ul {
      list-style: none;
      margin: 0.35rem 0 0.85rem 0;
    }
    #content li {
      position: relative;
      font-size: 0.825rem;
      color: #555;
      line-height: 1.72;
      padding-left: 1rem;
      margin-bottom: 0.2rem;
    }
    #content li::before {
      content: '–';
      position: absolute;
      left: 0;
      color: #ccc;
    }
    #content li strong { color: #1c1c1c; }

    /* Tables */
    #content table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.6rem 0 1rem;
      font-size: 0.825rem;
    }
    #content thead { display: none; }
    #content td {
      padding: 0.4rem 1rem 0.4rem 0;
      vertical-align: top;
      border-bottom: 1px solid #f2f2f2;
      color: #555;
      line-height: 1.65;
    }
    #content td:first-child {
      font-weight: 500;
      color: #888;
      white-space: nowrap;
      width: 1%;
    }
    #content tr:last-child td { border-bottom: none; }

    /* Code blocks */
    #content pre {
      font-family: 'JetBrains Mono', 'SF Mono', monospace;
      font-size: 0.76rem;
      background: #f8f8f7;
      border: 1px solid #eeeeed;
      border-radius: 4px;
      padding: 0.85rem 1rem;
      overflow-x: auto;
      line-height: 1.65;
      color: #444;
      margin: 0.6rem 0 1rem;
    }
    #content code {
      font-family: 'JetBrains Mono', 'SF Mono', monospace;
      font-size: 0.82em;
      background: #f3f3f2;
      padding: 0.1em 0.3em;
      border-radius: 3px;
      color: #444;
    }
    #content pre code { background: none; padding: 0; }

    /* Horizontal rule */
    #content hr { display: none; }

    /* Italic (timestamp at end) */
    #content em {
      font-size: 0.75rem;
      color: #ccc;
      font-style: normal;
    }
    #content p:has(> em:only-child) {
      margin-top: 2.5rem;
      padding-top: 1.75rem;
      border-top: 1px solid #f0f0ee;
    }

    /* ── Loading ─────────────────────────────────────── */
    .loading {
      display: flex;
      gap: 5px;
      align-items: center;
      padding: 3rem 0;
    }
    .dot {
      width: 4px; height: 4px;
      background: #ddd;
      border-radius: 50%;
      animation: blink 1.2s ease-in-out infinite;
    }
    .dot:nth-child(2) { animation-delay: .2s; }
    .dot:nth-child(3) { animation-delay: .4s; }
    @keyframes blink {
      0%, 100% { opacity: .2; } 50% { opacity: 1; }
    }

    /* ── Print ──────────────────────────────────────── */
    @media print {
      .page { padding: 0; max-width: 100%; }
      #content h1 { border-top-color: #ccc !important; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header id="hero"><div class="loading"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></header>
    <main id="content"></main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked@9/marked.min.js"></script>
  <script>
    marked.setOptions({ breaks: false, gfm: true });

    fetch('cv.md?' + Date.now())
      .then(r => { if (!r.ok) throw new Error(r.status); return r.text(); })
      .then(md => {
        const lines = md.split('\n');

        // Split header block (before first ---) from body
        const hrIdx = lines.findIndex(l => l.trim() === '---');
        const header = lines.slice(0, hrIdx > -1 ? hrIdx : 8);
        const body   = lines.slice(hrIdx > -1 ? hrIdx + 1 : 8).join('\n');

        // Parse hero fields
        const name    = (header.find(l => l.startsWith('# ')) || '').slice(2).trim();
        const tagline = (header.find(l => l.startsWith('**')) || '').replace(/\*\*/g, '').trim();
        const contact = header
          .filter(l => l.trim() && !l.startsWith('#') && !l.startsWith('**') && !l.startsWith('-'))
          .join('<br>')
          .replace(/([\w.+%-]+@[\w.-]+\.\w+)/g, '<a href="mailto:$1">$1</a>');

        document.querySelector('title').textContent = name + ' · CV';
        document.getElementById('hero').innerHTML = `
          <h1>${name}</h1>
          ${tagline ? `<p class="tagline">${tagline}</p>` : ''}
          ${contact ? `<p class="contact">${contact}</p>` : ''}
        `;

        // Render body markdown
        document.getElementById('content').innerHTML = marked.parse(body);

        // Post-process: split "Role | Date" in h2 and h3
        document.querySelectorAll('#content h2, #content h3').forEach(el => {
          const txt = el.textContent;
          const sep = txt.lastIndexOf(' | ');
          if (sep === -1) return;
          const role = txt.slice(0, sep);
          const date = txt.slice(sep + 3);
          const isH2 = el.tagName === 'H2';
          el.innerHTML = isH2
            ? `<span class="role">${role}</span><span class="date">${date}</span>`
            : `<span class="proj-title">${role}</span><span class="proj-date">${date}</span>`;
        });
      })
      .catch(e => {
        document.getElementById('hero').innerHTML = `<p style="color:#e00;font-size:.8rem">cv.md 加载失败：${e.message}</p>`;
      });
  </script>
</body>
</html>
